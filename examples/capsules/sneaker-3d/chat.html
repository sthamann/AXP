<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Shopping Assistant - Sport Shoes</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif;
            background: #343541;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        /* Header */
        .header {
            background: #202123;
            border-bottom: 1px solid #2d2d30;
            padding: 16px 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .header-title {
            color: #fff;
            font-size: 16px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .status-indicator {
            width: 8px;
            height: 8px;
            background: #10a37f;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* Chat Container */
        .chat-container {
            flex: 1;
            overflow-y: auto;
            padding-bottom: 24px;
        }

        .chat-wrapper {
            max-width: 900px;
            margin: 0 auto;
            padding: 32px 24px;
        }
        
        /* Messages */
        .message {
            display: flex;
            gap: 20px;
            padding: 24px 20px;
            animation: fadeIn 0.3s ease-in;
            border-radius: 16px;
            margin: 8px 0;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .message.user {
            background: rgba(52, 53, 65, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .message.assistant {
            background: rgba(68, 70, 84, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            flex-shrink: 0;
        }
        
        .user .avatar {
            background: #5436da;
        }
        
        .assistant .avatar {
            background: #10a37f;
        }
        
        .message-content {
            flex: 1;
            color: #d1d5db;
            line-height: 1.6;
            font-size: 15px;
        }
        
        .message-content p {
            margin-bottom: 12px;
        }
        
        .message-content p:last-child {
            margin-bottom: 0;
        }
        
        /* Product Cards */
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin: 28px 0;
        }
        
        .product-card {
            background: #202123;
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid #2d2d30;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .product-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            border-color: #10a37f;
        }
        
        .product-card.selected {
            border-color: #10a37f;
            box-shadow: 0 0 0 2px #10a37f;
        }
        
        .product-image {
            width: 100%;
            height: 200px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .shoe-icon {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 8px;
            opacity: 0.9;
        }
        
        .experience-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #10a37f;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .experience-badge::before {
            content: "✨";
        }
        
        .product-info {
            padding: 16px;
        }

        .product-name {
            color: #fff;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 15px;
            line-height: 1.3;
        }

        .product-price {
            color: #10a37f;
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 6px;
        }

        .product-details {
            color: #8e8ea0;
            font-size: 13px;
            margin-top: 6px;
            line-height: 1.4;
        }
        
        /* Embedded Experience */
        .experience-container {
            margin: 20px 20px 20px 0;
            border-radius: 16px;
            overflow: visible;
            border: 1px solid #2d2d30;
            background: #000;
            height: 700px;
            position: relative;
            box-shadow: 0 8px 32px rgba(0,0,0,0.5);
        }
        
        .experience-loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #8e8ea0;
            text-align: center;
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #2d2d30;
            border-top-color: #10a37f;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .experience-frame {
            width: 100%;
            height: 100%;
            border: none;
        }
        
        /* Input Area */
        .input-area {
            background: #343541;
            border-top: 1px solid #2d2d30;
            padding: 24px;
        }

        .input-wrapper {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            gap: 16px;
            align-items: center;
        }
        
        .input-field {
            flex: 1;
            background: #40414f;
            border: 1px solid #2d2d30;
            border-radius: 10px;
            padding: 16px 20px;
            color: #fff;
            font-size: 15px;
            outline: none;
            transition: border-color 0.2s;
        }
        
        .input-field:focus {
            border-color: #10a37f;
        }
        
        .send-button {
            background: #10a37f;
            border: none;
            border-radius: 10px;
            padding: 16px 24px;
            color: white;
            font-weight: 600;
            font-size: 15px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .send-button:hover:not(:disabled) {
            background: #0d8862;
        }
        
        .send-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Typing Indicator */
        .typing-indicator {
            display: flex;
            gap: 4px;
            padding: 10px;
        }
        
        .typing-dot {
            width: 8px;
            height: 8px;
            background: #8e8ea0;
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }
        
        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
            }
            30% {
                transform: translateY(-10px);
            }
        }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .product-grid {
                grid-template-columns: 1fr;
            }

            .experience-container {
                height: 450px;
                margin-right: 0;
            }

            .chat-wrapper {
                padding: 16px;
            }

            .message {
                padding: 16px 12px;
                margin: 6px 0;
                border-radius: 12px;
            }

            .header {
                padding: 12px 16px;
            }

            .input-area {
                padding: 16px;
            }

            .input-wrapper {
                gap: 12px;
            }

            .input-field {
                padding: 12px 16px;
                font-size: 16px; /* Prevents zoom on iOS */
            }

            .send-button {
                padding: 12px 20px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-title">
            <span class="status-indicator"></span>
            AI Shopping Experience Demo
        </div>
        <div style="color: #8e8ea0; font-size: 12px;">
            Powered by AXP Protocol
        </div>
    </div>
    
    <div class="chat-container" id="chatContainer">
        <div class="chat-wrapper" id="chatWrapper">
            <!-- Messages will be inserted here -->
        </div>
    </div>
    
    <div class="input-area">
        <div class="input-wrapper">
            <input type="text" class="input-field" id="userInput" placeholder="Ask about sport shoes..." disabled>
            <button class="send-button" id="sendButton" disabled>Send</button>
        </div>
    </div>
    
    <script>
        class ChatInterface {
            constructor() {
                this.chatWrapper = document.getElementById('chatWrapper');
                this.chatContainer = document.getElementById('chatContainer');
                this.userInput = document.getElementById('userInput');
                this.sendButton = document.getElementById('sendButton');
                this.messageIndex = 0;
                this.selectedProduct = null;
                
                this.conversation = [
                    {
                        type: 'user',
                        content: "Hi! I'm looking for sport shoes for running. Can you help me find something comfortable and stylish?"
                    },
                    {
                        type: 'assistant',
                        content: "Hello! I'd be happy to help you find the perfect running shoes. I have some excellent options that combine comfort, performance, and style. Let me show you our top recommendations:",
                        delay: 1500
                    },
                    {
                        type: 'assistant',
                        content: 'products',
                        delay: 2000,
                        products: [
                            {
                                id: 'nike-v2',
                                name: 'Nike Shoe V2',
                                price: '€189.00',
                                details: 'Premium running shoe',
                                hasExperience: true,
                                color: '#FF6900'
                            },
                            {
                                id: 'ultra-boost',
                                name: 'Ultra Boost 5.0',
                                price: '€179.00',
                                details: 'Maximum comfort',
                                hasExperience: false,
                                color: '#667eea'
                            },
                            {
                                id: 'swift-run',
                                name: 'Swift Run X',
                                price: '€139.00',
                                details: 'Lightweight design',
                                hasExperience: false,
                                color: '#764ba2'
                            }
                        ]
                    },
                    {
                        type: 'user',
                        content: "The Nike Shoe V2 looks interesting! Can you tell me more about it?",
                        delay: 3000
                    },
                    {
                        type: 'assistant',
                        content: "Excellent choice! The Nike Shoe V2 is one of our premium running shoes with cutting-edge technology. It features:\n\n• Advanced cushioning system for maximum comfort\n• Breathable mesh upper for optimal airflow\n• Responsive midsole for energy return\n• Available in multiple colorways\n• Sizes from EU 38-46\n\nI can show you an interactive 3D experience of this shoe where you can explore it from all angles and customize the color. Would you like to see it?",
                        delay: 1500
                    },
                    {
                        type: 'user',
                        content: "Yes, I'd love to see the 3D experience!",
                        delay: 2000
                    },
                    {
                        type: 'assistant',
                        content: "Perfect! I'm loading the interactive 3D experience for the Nike Shoe V2. You'll be able to:\n\n• Rotate the shoe 360° to see all angles\n• Try different colorways\n• Select your size\n• Add it directly to your cart\n\nHere's your personalized experience:",
                        delay: 1500
                    },
                    {
                        type: 'assistant',
                        content: 'experience',
                        delay: 2500
                    },
                    {
                        type: 'assistant',
                        content: "Feel free to interact with the 3D model above! You can drag to rotate it, select different colors, and choose your size. The shoe features our latest technology for superior comfort and performance.\n\n**Experience the future of shopping with our immersive 3D product visualization.**",
                        delay: 3000
                    }
                ];
                
                this.init();
            }
            
            init() {
                this.startConversation();
                
                // Simulate user interaction
                this.userInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && !this.sendButton.disabled) {
                        this.handleUserInput();
                    }
                });
                
                this.sendButton.addEventListener('click', () => {
                    if (!this.sendButton.disabled) {
                        this.handleUserInput();
                    }
                });
            }
            
            async startConversation() {
                for (const message of this.conversation) {
                    if (message.delay) {
                        await this.sleep(message.delay);
                    }
                    
                    if (message.type === 'assistant' && message.content !== 'products' && message.content !== 'experience') {
                        await this.showTypingIndicator();
                    }
                    
                    if (message.content === 'products') {
                        this.addProductCards(message.products);
                    } else if (message.content === 'experience') {
                        this.addExperience();
                    } else {
                        this.addMessage(message.type, message.content);
                    }
                    
                    this.scrollToBottom();
                }
                
                // Enable input after conversation
                this.userInput.disabled = false;
                this.sendButton.disabled = false;
                this.userInput.placeholder = "Type your message...";
            }
            
            addMessage(type, content) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${type}`;
                
                const avatar = document.createElement('div');
                avatar.className = 'avatar';
                avatar.textContent = type === 'user' ? 'U' : 'AI';
                
                const contentDiv = document.createElement('div');
                contentDiv.className = 'message-content';
                
                // Convert line breaks to paragraphs
                const paragraphs = content.split('\n\n');
                paragraphs.forEach(para => {
                    if (para.trim()) {
                        const p = document.createElement('p');
                        p.innerHTML = this.formatText(para);
                        contentDiv.appendChild(p);
                    }
                });
                
                messageDiv.appendChild(avatar);
                messageDiv.appendChild(contentDiv);
                this.chatWrapper.appendChild(messageDiv);
            }
            
            formatText(text) {
                // Format bold text
                text = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                // Format bullet points
                text = text.replace(/^• /gm, '• ');
                // Convert line breaks
                text = text.replace(/\n/g, '<br>');
                return text;
            }
            
            addProductCards(products) {
                const messageDiv = document.createElement('div');
                messageDiv.className = 'message assistant';
                
                const avatar = document.createElement('div');
                avatar.className = 'avatar';
                avatar.textContent = 'AI';
                
                const contentDiv = document.createElement('div');
                contentDiv.className = 'message-content';
                
                const grid = document.createElement('div');
                grid.className = 'product-grid';
                
                products.forEach(product => {
                    const card = document.createElement('div');
                    card.className = 'product-card';
                    if (product.hasExperience) {
                        card.classList.add('has-experience');
                    }
                    
                    card.innerHTML = `
                        <div class="product-image" style="background: linear-gradient(135deg, ${product.color} 0%, #434343 100%);">
                            <img class="shoe-icon" src="shoe-308566_1280.png" alt="Running Shoe">
                            ${product.hasExperience ? '<div class="experience-badge">3D Experience</div>' : ''}
                        </div>
                        <div class="product-info">
                            <div class="product-name">${product.name}</div>
                            <div class="product-price">${product.price}</div>
                            <div class="product-details">${product.details}</div>
                        </div>
                    `;
                    
                    card.addEventListener('click', () => {
                        document.querySelectorAll('.product-card').forEach(c => c.classList.remove('selected'));
                        card.classList.add('selected');
                        this.selectedProduct = product;
                    });
                    
                    grid.appendChild(card);
                });
                
                contentDiv.appendChild(grid);
                messageDiv.appendChild(avatar);
                messageDiv.appendChild(contentDiv);
                this.chatWrapper.appendChild(messageDiv);
                
                // Auto-select the product with experience
                setTimeout(() => {
                    const experienceCard = document.querySelector('.product-card.has-experience');
                    if (experienceCard) {
                        experienceCard.click();
                    }
                }, 500);
            }
            
            addExperience() {
                const messageDiv = document.createElement('div');
                messageDiv.className = 'message assistant';
                
                const avatar = document.createElement('div');
                avatar.className = 'avatar';
                avatar.textContent = 'AI';
                
                const contentDiv = document.createElement('div');
                contentDiv.className = 'message-content';
                
                const experienceContainer = document.createElement('div');
                experienceContainer.className = 'experience-container';
                experienceContainer.innerHTML = `
                    <div class="experience-loading">
                        <div class="loading-spinner"></div>
                        <div>Loading 3D Experience...</div>
                    </div>
                `;
                
                contentDiv.appendChild(experienceContainer);
                messageDiv.appendChild(avatar);
                messageDiv.appendChild(contentDiv);
                this.chatWrapper.appendChild(messageDiv);
                
                // Load the experience after a short delay
                setTimeout(() => {
                    const iframe = document.createElement('iframe');
                    iframe.className = 'experience-frame';
                    iframe.src = 'nike-viewer.html'; // Using nike-demo.usdz viewer
                    iframe.onload = () => {
                        experienceContainer.querySelector('.experience-loading').style.display = 'none';
                    };
                    experienceContainer.appendChild(iframe);
                }, 1000);
            }
            
            async showTypingIndicator() {
                const typingDiv = document.createElement('div');
                typingDiv.className = 'message assistant';
                typingDiv.id = 'typing-indicator';
                
                const avatar = document.createElement('div');
                avatar.className = 'avatar';
                avatar.textContent = 'AI';
                
                const contentDiv = document.createElement('div');
                contentDiv.className = 'message-content';
                
                const indicator = document.createElement('div');
                indicator.className = 'typing-indicator';
                indicator.innerHTML = `
                    <span class="typing-dot"></span>
                    <span class="typing-dot"></span>
                    <span class="typing-dot"></span>
                `;
                
                contentDiv.appendChild(indicator);
                typingDiv.appendChild(avatar);
                typingDiv.appendChild(contentDiv);
                this.chatWrapper.appendChild(typingDiv);
                
                this.scrollToBottom();
                
                await this.sleep(1000 + Math.random() * 1000);
                
                typingDiv.remove();
            }
            
            handleUserInput() {
                const text = this.userInput.value.trim();
                if (!text) return;
                
                this.addMessage('user', text);
                this.userInput.value = '';
                this.scrollToBottom();
                
                // Simulate AI response
                setTimeout(async () => {
                    await this.showTypingIndicator();
                    
                    const responses = [
                        "That's a great question! Based on your interest in the Nike Shoe V2, I can provide more details about its features and benefits.",
                        "I understand you're looking for more information. The Nike Shoe V2 has received excellent reviews from runners of all levels.",
                        "Thanks for your interest! Would you like to know about sizing, available colors, or perhaps our current promotions?",
                        "I'd be happy to help you with that. The Nike Shoe V2 combines style and performance in a way that few other shoes can match."
                    ];
                    
                    const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                    this.addMessage('assistant', randomResponse);
                    this.scrollToBottom();
                }, 500);
            }
            
            scrollToBottom() {
                this.chatContainer.scrollTo({
                    top: this.chatContainer.scrollHeight,
                    behavior: 'smooth'
                });
            }
            
            sleep(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        }
        
        // Initialize chat interface
        const chat = new ChatInterface();
    </script>
</body>
</html>
